# diandiandaka

#### 待完成工作
1. 离开“今天”界面时，要往数据库里更新所有被修改过的数据 【完成】✔️ 2018.08.02 22:27
2. 目前所有的图片，都换成从七牛获取，加快速速 【完成】✔️ 2018.08.03 13:15
3. “新卡片”图标完成左右滑动，避免图标太多导致遮挡，体验不好 【完成】✔️ 2018.08.03 13:29
4. “新卡片”支持用户上传自定义图标，图标统一上传到七牛云 【完成】✔️2018.08.03 14:35
5. 利用moment.js，将utils里关于时间的函数都improve一下 【完成】✔️ 2018.08.03 16:03
6. 修改dbhelper为仅剩增删改查 【完成】✔️ 2018.08.04 14:47
7. “今天”离开页面时统一更新topic_check表 【完成】 ✔️ 2018.08.04 16:50
8. “历史”部分接入topic_check表 【完成】 ✔️ 2018.08.04 20:50
9. “历史”部分完成历史日志的数据简单显示 【完成】 ✔️ 2018.08.05 12:42
10. “历史”部分完成图表数据计算与展示 【完成】 ✔️ 2018.08.07 13:17
11. “历史”部分完成历史日志的界面优化 【完成】 ✔️ 2018.08.07 20:24
12. “今天”实现删除打卡功能 【完成】 ✔️ 2018.08.10 16:13
13. 显示每个卡片的完成度 【完成】 ✔️ 2018.08.12 18:53
14. “历史”图表新增单击显示当日完成计划（除了[一年]之外，因为[一年]显示的是平均值）
15. 完成“卡片设置”页面 【完成】 ✔️ 
16. 完成“卡片设置”后端数据库的增删改查 【完成】 ✔️ 
17. 完成设置里的【修改用户名】功能 【完成】 ✔️ 2018.08.12 22:15
18. 完成onload和onshow的功能重组和优化 【完成】 ✔️ 2018.08.13 09:38
19. 完成"我"->"设置"里的页面和功能 【完成】 ✔️
20. 这里是列表文本设置打卡的时候，如果已经设置，要自动打开 【完成】 ✔️ 2018.08.16 15:16
21. 完成打卡提醒推送通知  【完成】 ✔️ 2018.08.16 15:16
22. 安插多个搜集form_id的地方 【完成】 ✔️ 2018.08.16 15:16
23. 脚本，自动查看人数为0的topic和图片，删除之 【完成】 ✔️  2018.08.20 10:30
24. 接入promise，修改所有后端代码为异步执行  【完成】 ✔️ 2018.08.20 14:20
25. 完成我的榜单
26. 完成编辑个人资料





#### 待修复的bug
1. “打卡历史”每日完成度真机echarts页面穿透问题【完成】 ✔️ 2018.08.07 21:52
    
    原因：page设置了position:fix;所有的设置都反过来了，fix的跟着动，不fix的却不动。

2. “打卡历史”每日完成度真机无法触发拖拽事件【完成】 ✔️ 2018.08.07 22:05

    原因：echarts的微信小程序组件自带bindtouchstart和bindtouchmove，导致我自己设置的失效。只是不知道为什么在电脑端测试的时候不失效，真机反而失效了。

3. “打卡历史”每日完成度选择不同timelapse按钮会跟着上下移动的问题 【完成】 ✔️ 2018.08.12 15:18
4. 真机动画无效 1)打卡的动画 2)“我” -> “我的打卡”动画 【完成】 ✔️ 2018.08.10 18:55
5. 修复离开“今天”， 无法保存打卡数据的bug 【完成】 ✔️ 2018.08.11 15:09
6. 修复查看图表的时候，不同机型，timelapse button位置不同的bug 【完成】 ✔️ 2018.08.11 17:51
7. 修复无数据界面为空的bug（做一些可爱的错误提示）【完成】 ✔️ 2018.08.11 21:37
8. 修复图表时间显示，开始打卡日期到当天为止的时间内，如果没打卡要显示为0%，不能显示为null  【完成】 ✔️ 2018.08.13 10:06
9. 安卓手机添加新卡片的图片不显示 【完成】 ✔️ 2018.08.13 15:20
10. 安卓手机“历史” 无数据时提示不友好 【完成】 ✔️ 2018.08.13 15:29
11. 安卓手机“每日完成度” 标题不居中，错误标签重叠在一起【完成】 ✔️ 2018.08.13 16:33
12. 我的卡片，无卡片时需要提示 【完成】 ✔️ 2018.08.13 16:48
13. “我” 不换头像之前，无法单击换头像 【完成】 ✔️ 2018.08.13 16:57
14. 真机的地区选择框显示不全 【完成】 ✔️ 2018.08.16 16:11
15. 修改所有后端api为按照功能划分，而不是按照数据库




#### 项目介绍
微信小程序，点点打卡

#### 开发教程

服务器

1. 进入/home/ubuntu/receiver，运行node server.js打开本地和服务器同步的接口
2. redis-server & 在后端打开redis
3. mysql -uroot diandiandaka -p （mysql123）打开数据库
4. 进入/home/ubuntu/diandiandaka，运行pm2 log bin/www --watch --name dddk，再运行pm2 log dddk即可查看日志
5. 进入/usr/local/nginx（nginx当时是用编译安装的），运行sbin/nginx -c conf/nginx.conf，启动nginx
6. 如果要编辑定时任务，crontab -e修改即可，crontab -l查看定时任务是否被添加

本地
1. 进入开发目录，进入server目录，运行fis3 release -w，即可自动监控改动同步到服务器

至此，可以开始开发了。



#### 安装教程

服务器端

1. clone到本地，只保留server部分，client部分可以删除
2. 主目录下运行npm install => pm2 start bin/www --watch --name diandiandaka，之后可用pm2 log diandiandaka查看运行日志
3. 运行定时任务，在主目录下运行crontab crontab_file即可

小程序端

直接pull放到微信开发者工具即可运行

#### 使用说明

1. xxxx
2. xxxx
3. xxxx
